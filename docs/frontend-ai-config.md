# 前端 AI 配置功能说明

## 功能概述

用户可以在前端界面直接配置 AI 提供商和联网搜索功能，无需修改服务器配置。配置会保存到浏览器的 localStorage 中，下次访问时自动恢复。

## UI 设计

### 1. 设置按钮位置
- 位于输入框下方居中
- 图标：设置图标（未展开）/ 向上箭头（已展开）
- 极简设计，不干扰主界面

### 2. 设置面板
- 点击设置按钮展开/收起
- 动画效果：淡入淡出 + 高度过渡
- 圆角卡片设计，与输入框风格一致

### 3. 配置选项

#### AI Provider 选择
```
┌─────────────────────────────────┐
│ AI Provider      [Gemini] [OpenAI] │
└─────────────────────────────────┘
```
- 两个按钮切换
- 选中状态：蓝色背景 + 白色文字
- 未选中状态：灰色背景 + 灰色文字

#### 联网搜索开关（仅 Gemini）
```
┌─────────────────────────────────┐
│ 🌐 联网搜索           [开关]      │
└─────────────────────────────────┘
```
- 仅在选择 Gemini 时显示
- Toggle 开关样式
- 开启：蓝色背景
- 关闭：灰色背景

#### 说明文字
- 底部显示当前配置的简短说明
- 字体大小：10px
- 颜色：灰色

### 4. 快捷按钮（输入框内）
- 联网搜索图标（🌐）显示在输入框左下角
- 仅在选择 Gemini 时显示
- 点击快速切换联网搜索状态
- 状态指示：
  - 启用：蓝色背景 + 蓝色图标
  - 禁用：灰色图标

## 数据存储

### localStorage Keys
```javascript
// AI 提供商选择
'alice-ai-provider': 'gemini' | 'openai'

// 联网搜索开关
'alice-enable-search': 'true' | 'false'
```

### 默认值
- AI Provider: `'gemini'`
- Enable Search: `false`

## API 交互

### 请求参数
```typescript
{
  input: string,
  history: Array<{ role: 'user' | 'assistant', content: string }>,
  sessionId: string,
  aiProvider: 'gemini' | 'openai',  // 新增
  enableSearch: boolean              // 新增
}
```

### 服务端处理逻辑
1. 客户端配置优先级高于服务器环境变量
2. 如果客户端指定 `aiProvider`，使用客户端选择
3. 如果客户端未指定，使用服务器 `USE_OPENAI` 环境变量
4. 联网搜索仅在 Gemini + `enableSearch=true` 时启用

## 功能特性

### 1. AI Provider 切换
- **Gemini**
  - 支持联网搜索（Google Search）
  - 免费配额（有限制）
  - 响应速度快
  
- **OpenAI**
  - 不支持联网搜索
  - 支持自定义端点（兼容 API）
  - 可使用 GPT-4、GPT-3.5 等模型

### 2. 联网搜索
- 仅 Gemini 支持
- 使用 Google Search grounding
- 可获取实时信息
- 自动引用来源

### 3. 配置持久化
- 自动保存到 localStorage
- 刷新页面后保持配置
- 跨标签页共享配置

## 用户体验

### 1. 视觉反馈
- 按钮状态清晰（选中/未选中）
- Toggle 开关动画流畅
- 设置面板展开/收起动画自然

### 2. 交互便捷
- 一键切换 AI 提供商
- 快捷按钮快速开关联网搜索
- 设置面板可折叠，不占用空间

### 3. 信息提示
- 悬停显示功能说明
- 底部文字说明当前配置
- 联网搜索图标状态明确

## 样式规范

### 颜色方案
```css
/* 主色调 */
--primary: #3b82f6;        /* 蓝色 */
--primary-hover: #2563eb;  /* 深蓝色 */

/* 背景色 */
--bg-light: #f9fafb;       /* 浅灰色 */
--bg-dark: #1f2937;        /* 深灰色 */

/* 文字颜色 */
--text-light: #374151;     /* 深灰色文字 */
--text-dark: #e5e7eb;      /* 浅灰色文字 */

/* 边框颜色 */
--border-light: #e5e7eb;   /* 浅灰色边框 */
--border-dark: #374151;    /* 深灰色边框 */
```

### 圆角规范
- 输入框：`rounded-3xl` (24px)
- 设置面板：`rounded-2xl` (16px)
- 按钮：`rounded-xl` (12px)
- Toggle 开关：`rounded-full`

### 间距规范
- 面板内边距：`p-4` (16px)
- 元素间距：`gap-1` (4px) / `gap-2` (8px) / `gap-3` (12px)
- 分隔线上下间距：`pt-2` (8px)

## 示例场景

### 场景 1：使用 Gemini + 联网搜索
1. 点击设置按钮
2. 选择 "Gemini"
3. 开启 "联网搜索"
4. 输入问题："今天的天气怎么样？"
5. AI 会联网查询实时天气信息

### 场景 2：切换到 OpenAI
1. 点击设置按钮
2. 选择 "OpenAI"
3. 联网搜索选项自动隐藏
4. 输入问题，使用 OpenAI API 回答

### 场景 3：快速切换联网搜索
1. 确保选择了 Gemini
2. 点击输入框左下角的 🌐 图标
3. 联网搜索状态立即切换
4. 无需打开设置面板

## 注意事项

1. **服务器配置要求**
   - 使用 OpenAI 需要配置 `API_KEY`
   - 使用 Gemini 需要配置 Vertex AI 凭据

2. **功能限制**
   - OpenAI 不支持联网搜索
   - 联网搜索仅在 Gemini 下可用

3. **性能考虑**
   - 联网搜索可能增加响应时间
   - 建议按需开启

4. **隐私说明**
   - 配置保存在本地浏览器
   - 不会上传到服务器
   - 清除浏览器数据会重置配置

